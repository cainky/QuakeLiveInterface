# QuakeLiveInterface - Full Stack with Custom MinQLX Build
#
# Usage:
#   docker-compose build   # Build the custom image (first time only)
#   docker-compose up -d   # Start the stack
#   Connect to localhost:27960 in Quake Live

services:
  redis:
    image: redis:7-alpine
    container_name: ql-redis
    ports:
      - "127.0.0.1:6379:6379"
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 5s
      timeout: 3s
      retries: 5
    restart: unless-stopped

  quake-server:
    build:
      context: .
      dockerfile: Dockerfile.server
    image: quakelive-agent:latest
    container_name: ql-server
    ports:
      - "27960:27960/udp"
      - "27960:27960/tcp"
    volumes:
      - ./minqlx-plugin:/qlds/minqlx_plugins:ro
    environment:
      - QLX_REDISADDRESS=redis
      - QLX_OWNER=76561197984141695
      - QLX_AGENTSTEAMID=76561197984141695
      - MAP=campgrounds
    depends_on:
      redis:
        condition: service_healthy
    restart: unless-stopped

networks:
  default:
    name: quakelive-net
